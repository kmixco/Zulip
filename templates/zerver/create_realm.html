{% extends "zerver/portico_signup.html" %}
{# Home page for not logged-in users. #}

{# This is where we pitch the app and solicit signups. #}

{% block portico_content %}
<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mailcheck/1.1.2/mailcheck.js"></script>
</head>

<body>
<div class="app register-page">
	<div class="app-main register-page-container new-style flex full-page center">
		<div class="register-form left">
			<div class="lead">
				<h1 class="get-started">{{ _("Create a new Zulip organization") }}</h1>
			</div>
			<div class="white-box">
				<form class="form-inline" id="send_confirm" name="email_form" 
				  action="{{ current_url() }}" method="post">
					{{ csrf_input }}
					<div class="input-box horizontal">
						<div class="inline-block relative">
							<input type="email" class="email required" placeholder="{{ _("Enter your email address") }}"
										  id="email" name="email" autofocus required />
							<label for="email">{{ _('Email') }}</label>
						</div>
						<button type="submit" class="new-organization-button register-button">{{ _("Create organization") }}</button>
					</div>
				</form>
				<div class="bottom-suggestion" id="hint"></div>
			</div>
			<div class="bottom-text">
				Or import
				from <a href="/help/import-from-slack">Slack</a>, <a href="/help/import-from-mattermost">Mattermost</a>,
				<a href="/help/import-from-hipchat">HipChat</a> or <a href="/help/import-from-gitter">Gitter</a>.
			</div>
		</div>
	</div>
</div>
<script>
	var email = jQuery('#email');
	var hint = jQuery('#hint');
	(function($){
		$('input[type=email]').on('keydown', function(e) {
		if (e.which == 13) {
			e.preventDefault();
		}	
		});
		
		email.on('blur',function() {
			hint.css('display', 'none').empty();
			$(this).mailcheck({
				suggested: function(element, suggestion) {
					if(!hint.html()) {
						 var suggestion = "Did you mean <span class='suggestion'>" +
							"<span class='address'>" + suggestion.address + "</span>"
							+ "@<a href='#' class='domain'>" + suggestion.domain +
							"</a></span>?";
						hint.html(suggestion).fadeIn(150);
						alert("Email address typed is Misspelled! Click 'OK' to view suggested emails!");
					} else {
						jQuery(".address").html(suggestion.address);
						jQuery(".domain").html(suggestion.domain);
					}
				}
			});
		});
	})(jQuery);
	(function($){
		hint.on('click', '.domain', function() {
			email.val(jQuery(".suggestion").text());
			hint.fadeOut(200, function() {
				$(this).empty();
			});
			return false;
		});
	})(jQuery);
</script>
</body>
</html>

{% endblock %}
