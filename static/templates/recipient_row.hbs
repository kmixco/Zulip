{{#if is_stream}}
<div class="message_header message_header_stream right_part">
    <div class="message-header-wrapper">
        <div class="message-header-contents">
            {{! stream link }}
            <a class="message_label_clickable narrows_by_recipient stream_label {{color_class}}"
                style="background: {{background_color}}; border-left-color: {{background_color}};"
                href="{{stream_url}}"
                title="{{#tr this}}Narrow to stream &quot;__display_recipient__&quot;{{/tr}}">
                {{! invite only lock }}
                {{#if invite_only}}
                <i class="fa fa-lock invite-stream-icon" title="{{t 'This is a private stream' }}" aria-label="{{t 'This is a private stream' }}"></i>
                {{/if}}
                {{display_recipient}}</a>

            {{! hidden narrow icon for copy-pasting }}
            <span class="copy-paste-text">&gt;</span>

            {{! topic stuff }}
            <span class="stream_topic">
                {{! topic link }}
                <a class="message_label_clickable narrows_by_topic"
                    href="{{topic_url}}"
                    title="{{#tr this}}Narrow to stream &quot;__display_recipient__&quot;, topic &quot;__topic__&quot;{{/tr}}">
                    {{#if use_match_properties}}
                    {{{match_topic}}}
                    {{else}}
                    {{topic}}
                    {{/if}}
                </a>
                <!-- The missing whitespace on the next line is a hack; ideally, would be user-select: none. -->
            </span><span class="recipient_bar_controls no-select">
                {{! exterior links (e.g. to a trac ticket) }}
                {{#each topic_links}}
                <a href="{{this}}" target="_blank" class="no-underline">
                    <i class="fa fa-external-link-square" aria-label="{{t 'External link' }}"></i>
                </a>
                {{/each}}

                {{! edit topic pencil icon }}
                {{#if always_visible_topic_edit}}
                    <i class="fa fa-pencil always_visible_topic_edit" {{#unless realm_allow_message_editing}}style="display: none"{{/unless}} role="button" tabindex="0" aria-label="{{t 'Edit' }}"></i>
                {{else}}
                    {{#if on_hover_topic_edit}}
                    <i class="fa fa-pencil on_hover_topic_edit" {{#unless realm_allow_message_editing}}style="display: none"{{/unless}} role="button" tabindex="0" aria-label="{{t 'Edit' }}"></i>
                    {{/if}}
                {{/if}}

                <span class="topic_edit">
                    <span class="topic_edit_form" id="{{id}}"></span>
                </span>

                <i class="fa fa-eye-slash on_hover_topic_mute" data-stream-id="{{stream_id}}" data-topic-name="{{topic}}" title="{{t 'Mute topic' }} (M)" role="button" tabindex="0" aria-label="{{t 'Mute topic' }} (M)"></i>
                <i class="fa fa-pencil copy_selected_messages" group="{{message_group_id}}"  role="button" tabindex="0" aria-label="{{t 'Copy markdown' }}"><span class="alert-grp pull-right"></span></i>
                <span class="recipient_row_date {{#if group_date_divider_html}}{{else}}hide-date{{/if}}">{{{date}}}</span>
            </span>
        </div>
    </div>
</div>
<div id="messages_markdown_{{message_group_id}}" class="messages_markdown">
    <div class="messages_markdown_content">
        <div class="messages_markdown_show">
            <button class="btn pull-right copy_messages_markdown" id="btn_copy_message_markdown_{{message_group_id}}" data-toggle="tooltip" title="{{t "Copy and close" }}" data-clipboard-target="#copy_message_markdown_{{message_group_id}}">
                <svg height="20" width="18" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg" id="clipboard_image">
                    <path fill="#777" d="M128 768h256v64H128v-64z m320-384H128v64h320v-64z m128 192V448L384 640l192 192V704h320V576H576z m-288-64H128v64h160v-64zM128 704h160v-64H128v64z m576 64h64v128c-1 18-7 33-19 45s-27 18-45 19H64c-35 0-64-29-64-64V192c0-35 29-64 64-64h192C256 57 313 0 384 0s128 57 128 128h192c35 0 64 29 64 64v320h-64V320H64v576h640V768zM128 256h512c0-35-29-64-64-64h-64c-35 0-64-29-64-64s-29-64-64-64-64 29-64 64-29 64-64 64h-64c-35 0-64 29-64 64z" />
                </svg>
            </button>
            <textarea id="copy_message_markdown_{{message_group_id}}" class="copy_message_markdown rendered_markdown" maxlength="10000" readonly style="width: 100%; overflow:hidden; overflow-wrap:break-word"></textarea>
        </div>
    </div>
</div>
{{else}}
<div class="message_header message_header_private_message dark_background">
    <div class="message-header-wrapper">
        <div class="message-header-contents">
            <a class="message_label_clickable narrows_by_recipient stream_label"
                href="{{pm_with_url}}"
                title="{{#tr this}}Narrow to your private messages with __display_reply_to__{{/tr}}">
                {{#tr this}}You and __display_reply_to__{{/tr}}
            </a>

            <span class="recipient_row_date {{#if group_date_divider_html}}{{else}}hide-date{{/if}}">{{{date}}}</span>
        </div>
    </div>
</div>
{{/if}}
