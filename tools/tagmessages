#!/usr/bin/env python
from __future__ import absolute_import
from __future__ import print_function

import os

from hashlib import md5
import polib

username = 'transifex_username'
password = 'transifex_password'
tools_dir = os.path.dirname(os.path.abspath(__file__))
root_dir = os.path.dirname(tools_dir)
# Choose any translation file for processing all strings.
po = polib.pofile(os.path.join(root_dir, 'static', 'locale', 'de', 'LC_MESSAGES', 'django.po'))
for entry in po:
    tag = entry.comment
    if tag:
        keys = [entry.msgid, entry.msgctxt or '']
        msg_hash = md5(':'.join(keys).encode('utf-8')).hexdigest()
        curl_call = 'curl -i -L --user {}:{} -X PUT -H "Content-Type: application/json" ' \
                    '--data \'{{"tags": ["{}"]}}\' https://www.transifex.com/api/2/project/zulip/resource' \
                    '/djangopo/source/{}'.format(username, password, tag, msg_hash)
        os.system(curl_call)
